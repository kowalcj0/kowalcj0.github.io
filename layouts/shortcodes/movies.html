{{ $category := (.Get "category") }}
{{ $sort_by := default "title" (.Get "sort_by") }}
{{ $order := default "asc" (.Get "order") }}
{{ $show_watched := default "yes" (.Get "show_watched") }}
{{ with $category }}
<table aria-label="Interesting {{ $category }} movies" style="font-size:80%;width:100%">
  <tbody>
{{ range $.Site.Data.movies }}
    {{ if eq $category .category }}
        {{ range sort .movies $sort_by $order }}
            {{ if .title }}
    <tr tabindex="0">
    <article id="movie-{{ .title | anchorize }}">
      <details id="details-{{ .title | anchorize }}">
          <summary id="{{ .title | anchorize }}"><b>{{ .title }}</b>, by {{ .director }}{{ if .original_title }} (orig. {{ .original_title }}){{ end }}, {{ .year }} {{ if and (.rating_my) (le .rating_my 0) }}{{ partial "svg/octicons/alert.svg" }}{{else}}{{ range (seq .rating_my) }}<img src="/img/octicons/star-fill.svg"/>{{ end }}{{ end }}<a class="octicon-link" href="#{{ .title | anchorize }}">{{ partial "svg/octicons/link.svg" }}</a></summary>
        <ul>
        {{ if .genres }}
        <li title="Genres" aria-label="Genres" style="list-style-image: url('/img/octicons/pencil.svg'); margin-left: 0.5rem">{{ delimit .genres ", " }}</li>
        {{ end }}
        {{ if .production_countries }}
        <li title="Production countries" aria-label="Production countries" style="list-style-image: url('/img/octicons/globe.svg'); margin-left: 0.5rem">{{ $len_countries := (len .production_countries) }}{{ range $idx, $country := .production_countries }} {{ $country.name }}{{ if ne $idx (sub $len_countries 1) }},{{ else }}{{ end }}{{ end }}</li>
        {{ end }}
        {{ if eq $show_watched "yes"}}
        {{ if .watched }}
        <li title="Seen on" aria-label="Seen on" style="list-style-image: url('/img/octicons/device-camera-video.svg'); margin-left: 0.5rem">{{ .watched }}</li>
        {{ end }}
        {{ end }}
        <li title="Links" aria-label="Links" style="list-style-image: url('/img/octicons/link-external.svg'); margin-left: 0.4rem">{{ partial "movie_links.html" . }}</li>
        {{ if .comments }}
        <li title="Comments" aria-label="Comments" style="list-style-image: url('/img/octicons/note.svg'); margin-left: 0.5rem" id="comments-{{ .title | anchorize }}">Comments: {{ .comments | markdownify }}</li>
        {{ end }}
        {{ if and (.rating_my) (le .rating_my 0) }}
        <li title="My rating" aria-label="My rating" style="list-style-image: url('/img/octicons/star-fill.svg'); margin-left: 0.5rem" id="rating-my-{{ .title | anchorize }}">My rating: <b>{{ .rating_my }} Stars. DO NOT WATCH IT! You've been warne</b>d</li>
        {{ end }}
        {{ if gt .rating_my 0 }}
        <li title="My rating" aria-label="My rating" style="list-style-image: url('/img/octicons/star-fill.svg'); margin-left: 0.5rem" id="rating-my-{{ .title | anchorize }}">My rating: {{ range (seq .rating_my) }}<img src="/img/octicons/star-fill.svg"/>{{ end }}</li>
        {{ end }}
        {{ if .rating_tmdb }}
        <li title="TMDB rating" aria-label="TMDB rating" style="margin-left: 0.5rem" id="rating-tmdb-{{ .title | anchorize }}"><img src="/img/tmdb.svg" style="width: 64px;"/> User score: <b title="{{ .rating_tmdb_count }} User score" aria-label="{{ .rating_tmdb_count }} User score">{{ mul .rating_tmdb 10 }}%</b></li>
        {{ end }}
        {{ if .rating_imdb }}
        <li title="IMDb ratings" aria-label="IMDb ratings" style="margin-left: 0.5rem" id="rating-imdb-{{ .title | anchorize }}"><img src="/img/imdb-site.svg" style="width: 64px;"/> User reviews: <b title="{{ .rating_imdb_count }} User reviews" aria-label="{{ .rating_imdb_count }} User reviews">{{ .rating_imdb }}<sub>/10</sub></b>{{ if .rating_imdb_metascore }} - Critic metascore: <b title="{{ .rating_imdb_critic_count }} Critic reviews" aria-label="{{ .rating_imdb_critic_count }} Critic reviews">{{ .rating_imdb_metascore }}<sub>/100</sub></b>{{ end }}</li>
        {{ end }}
        {{ if or (.rating_rt_audience) (.rating_rt_tomatometer) }}
        <li title="Rotten Tomatoes ratings" aria-label="Rotten Tomatoes ratings" style="margin-left: 0.5rem" id="rating-imdb-{{ .title | anchorize }}">{{ if .rating_rt_audience }}<img src="/img/rt_audience.svg" style="width: 24px;"/> Audience score: <b>{{ .rating_rt_audience }}%</b>{{ end }}{{ if and (.rating_rt_audience) (.rating_rt_tomatometer) }} - {{ end }}{{ if .rating_rt_tomatometer }}<img src="/img/rt_tomatometer.svg" style="width: 24px;"/> Tomatometer: <b>{{ .rating_rt_tomatometer }}%</b>{{ end }}</li>
        {{ end }}
        {{ if .quotes }}
        <li title="Quotes" aria-label="Quoutes" style="list-style-image: url('/img/octicons/quote.svg'); margin-left: 0.5rem" id="quotes-{{ .title | anchorize }}">Quotes:
          <ul>
              {{ range $quote := .quotes }}
              <li>{{ $quote | markdownify }}</li>
              {{ end }}
          </ul>
        </li>
        {{ end }}
        </ul>
      </details>
    </article>
    </tr>
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}
  </tbody>
</table>
{{ end }}
